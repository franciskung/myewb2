{% extends "networks/base.html" %}

{% load i18n %}
{% load uni_form_tags %}
{% load humanize %}
{% load pagination_tags %}
{% load order_by %}
{% load extra_tagging_tags %}
{% load networks_tags %}
{% load base_groups_tags %}
{% load sorting_tags %}
{% load cache %}

{% block head_title %}{% blocktrans %}Chapters{% endblocktrans %}{% endblock %}


{% block extra_head_base %}
    {{ block.super }}
    {# adding the map code just to this page #}
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAr4bFrclzv3t-BOujwrE_ChQ0Fohs0N8x-JP4ajf_M3hambhEhxQGoPFQ1wxpT0v6W-JM-Y1BcHXU7A" type="text/javascript"></script>

{% endblock %}

{% block body %}
    <h1>{% trans "Chapters" %}</h1>
    
    {% if not user.is_authenticated %}
        {% url acct_signup as signup_url %}
        {% url acct_login as login_url %}
        <p>{% blocktrans %}<a href="{{ signup_url }}">Sign up</a> and <a href="{{ login_url }}">log in </a> to join a chapter.{% endblocktrans %}</p>
    {% endif %}

	{% cache CACHE_TIMEOUT "chapterlist" %}    

    {% autosort groups %}
    {#{% autopaginate groups 10 %}#}
    {% if groups %}
    	
    	{# Hand coded for that premium taste! #}
    
    
    <div id="map" style="width: 550px; height: 250px; border: 1px solid black; margin: 10px auto; display:none;"></div>


    
    <div class="chapterlist">
    
<script type="text/javascript">//<![CDATA[
var cityArray = new Array();
//]]>
</script>

    
    
    	<h2 id="BC">British Columbia</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "BC" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city }}"] == null)
	{
		cityArray["{{group.chapter_info.city }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>

		        
	        {% endifequal %}
        {% endfor %}

    	<h2 id="AB">Alberta</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "AB" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city }}"] == null)
	{
		cityArray["{{group.chapter_info.city }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>
		        
	        {% endifequal %}
        {% endfor %}

    	<h2 id="SK">Saskatchewan</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "SK" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city }}"] == null)
	{
		cityArray["{{group.chapter_info.city }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>
		        
	        {% endifequal %}
        {% endfor %}

    	<h2 id="MB">Manitoba</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "MB" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city }}"] == null)
	{
		cityArray["{{group.chapter_info.city }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>
		        
	        {% endifequal %}
        {% endfor %}

    	<h2 id="ON">Ontario</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "ON" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city }}"] == null)
	{
		cityArray["{{group.chapter_info.city }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>
		        
	        {% endifequal %}
        {% endfor %}

    	<h2 id="QC">Qu&eacute;bec</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "QC" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city }}"] == null)
	{
		cityArray["{{group.chapter_info.city }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>
		        
	        {% endifequal %}
        {% endfor %}

    	<h2 id="NB">New Brunswick</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "NB" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city }}"] == null)
	{
		cityArray["{{group.chapter_info.city }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>
		        
	        {% endifequal %}
        {% endfor %}

    	<h2 id="NS">Nova Scotia</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "NS" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city }}"] == null)
	{
		cityArray["{{group.chapter_info.city }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>
		        
	        {% endifequal %}
        {% endfor %}

    	<h2 id="NL">Newfoundland and Labrador</h2>
        {% for group in groups %}
        	{% ifequal group.chapter_info.province "NL" %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
<script type="text/javascript">//<![CDATA[
	if(cityArray["{{group.chapter_info.city|escapejs }}"] == null)
	{
		cityArray["{{group.chapter_info.city|escapejs }}"] = new Object();
	}
    cityArray["{{group.chapter_info.city|escapejs }}"]["{{group.slug }}"] = "{{group.name }}";
//]]>
</script>
		        
	        {% endifequal %}
        {% endfor %}

    	
    	{% comment %}
    	<h2 id="other">Other</h2>
        {% for group in groups %}
        	{% if not group.chapter_info.province %}

		        <dl>
		            {% show_network group %}
		        </dl>
		        
		        
	        {% endif %}
        {% endfor %}
        
        
        {% endcomment %}
        
        
	</div>

        {#{% paginate %}#}
    {% endif %}
    
    
    {# map code #}
<script type="text/javascript">

		//<![CDATA[
			var HereIcon = new GIcon();
			HereIcon.image ="http://labs.google.com/ridefinder/images/mm_20_red.png";
			HereIcon.shadow ="http://labs.google.com/ridefinder/images/mm_20_shadow.png";
			HereIcon.iconSize = new GSize(12, 20);
			HereIcon.shadowSize = new GSize(22, 20);
			HereIcon.iconAnchor = new GPoint(6, 20);
			HereIcon.infoWindowAnchor = new GPoint(5, 1);

			var geoArray = {
			"Sherbrooke" : new GLatLng(45.347328, -71.936991),
			"Qu&eacute;bec" : new GLatLng(46.775109, -71.324011),
			"London" : new GLatLng(42.976427, -81.249659),
			"Windsor" : new GLatLng(42.291192, -82.997466),
			"Guelph" : new GLatLng(43.535309, -80.246183),
			"Hamilton" : new GLatLng(43.242711, -79.892195),
			"Halifax" : new GLatLng(44.65, -63.6),
			"Fredericton" : new GLatLng(45.957319, -66.647818),
			"Victoria" : new GLatLng(48.42804, -123.356467),
			"Burnaby" : new GLatLng(49.250494, -122.95967),
			"Edmonton" : new GLatLng(53.53279, -113.503383),
			"Calgary" : new GLatLng(51.039877, -114.080796),
			"Saskatoon" : new GLatLng(52.13142, -106.64594),
			"Regina" : new GLatLng(50.452557, -104.611296),
			"Winnipeg" : new GLatLng(49.875822, -97.148721),
			"St. John\x27s" : new GLatLng(47.550575, -52.746072),
			"Waterloo" : new GLatLng(43.477918, -80.537828),
			"Ottawa" : new GLatLng(45.352088, -75.72344),
			"Vancouver" : new GLatLng(49.250494, -123.111934),
			"Montreal" : new GLatLng(45.512363, -73.675627),
			"Toronto" : new GLatLng(43.723057, -79.392486)
			};

		function createMarker(city) 
		{
			var marker = new GMarker(geoArray[city], HereIcon);
			var data = "<div class=\"gmapsboxcontent\" align=\"center\" style=\"margin:0; padding: 0; font-size: 12px;\"><h3>" + city + "</h3>";
			for (var shortname in cityArray[city])
			{
				if(typeof shortname == "string")
				{
					data += "<a href=\"/networks/" + shortname+ "\">" + cityArray[city][shortname] + "</a>";  {# @@@ this URL is hardcoded in here by slug. #}
				}
			}

			GEvent.addListener(marker, "click", function() {marker.openInfoWindowHtml(data);});
			return marker;
		}

		function myEWBOnLoad() 
		{
			if (GBrowserIsCompatible()) 
			{
				document.getElementById("map").style.display = "block";
				var map = new GMap2(document.getElementById("map"));
				map.setCenter( new GLatLng(51.429013, -90.373047), 3);
				map.addControl(new GSmallMapControl());

				for(var city in geoArray) 
				{
					map.addOverlay(createMarker(city));
				}
			}
		}
		
		myEWBOnLoad();
		//]]>

    </script>		
    
    {% endcache %}
    
    
{% endblock %}

{% block toolbar_left %}
{% endblock %}

{% block toolbar_right %}


    {% if user.is_authenticated and user.get_networks %}
    	{% cache CACHE_TIMEOUT "mychapters" user.username %}
		<div class="toolbarheader bkgd" id="box-my-chapter">{% trans "My Chapters" %}</div>
		<div class="toolbarcontent">
	    {% for group in user.get_networks %}

			<div style="padding-bottom: 4px;">
				<a href="{% url group_detail group.slug %}">
					{% ifequal user.get_profile.get_chapter group %}
						<strong>{{ group.name }}</strong>
					{% else %}
						{{ group.name }}
					{% endifequal %}
				</a>
			</div>

    	{% endfor %}
		</div>
		{% endcache %}
	{% endif %}


    {% if not user.is_authenticated %}
<div class="toolbarheader bkgd" id="box-about-ewb-chapters">{% trans "About EWB Chapters" %}</div>
<div class="toolbarcontent">
	You can join EWB chapters across the country to get involved in our work in Canada.
</div>
{% endif %}


<div class="toolbarheader bkgd" id="box-chapters-by-province">{% trans "Chapters by Province" %}</div>
<div class="toolbarcontent provincelinklist">
	<a href="#BC">British Columbia</a>
	<a href="#AB">Alberta</a>
	<a href="#SK">Saskatchewan</a>
	<a href="#MB">Manitoba</a>
	<a href="#ON">Ontario</a>
	<a href="#QC">Qu&eacute;bec</a>
	<a href="#NB">New Brunswick</a>
	<a href="#NS">Nova Scotia</a>
	<a href="#NL">Newfoundland and Labrador</a>
	<!-- <a href="#other">Others</a> -->
</div>


    {% if user.is_authenticated and perms.chapters.create %}
<div class="toolbarheader bkgd" id="box-new-chapter">{% trans "New chapter" %}</div>
		<div class="toolbarcontent">
		You have permission to create chapters.
        <p><a href="{% url new_network %}">Get rockin'!</a></p>
</div>
    {% endif %}




{% endblock %}

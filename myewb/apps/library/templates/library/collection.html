{% extends 'library/base.html' %}

{% load time_filters %}
{% load dictionary_tags %}
{% load attachablecomments_tags %}
{% load truncate %}

{% block body_content %}
    <h2 style='margin-bottom: 5px;'>{{ collection.name }}</h2>
    
    {% with collection.get_breadcrumbs as breadcrumbs %}
        {% if breadcrumbs %}
            In 
            
            {% for bc in breadcrumbs %}
                {% if forloop.first %}
                    {% if bc.featured %}
                        <a href="{% url library_home %}">Library</a>
                        <span style='padding: 0 5px;'>&raquo;</span>
                    {% endif %}
                {% endif %}
                
                <a href="{% url library_collection bc.id %}">{{ bc.name }}</a>
                
                {% if forloop.last %}
                    &nbsp;
                {% else %}
                    <span style='padding: 0 5px;'>&raquo;</span>
                {% endif %}
                
            {% endfor %}
            
        {% else %}
            {% if not collection.parent %}
                {% if collection.featured %}
                    <a href="{% url library_home %}">Back to the Library</a>
                {% endif %}
            {% endif %}
        
        {% endif %}
    {% endwith %}
    <hr/>
    
{#    <div style='border: 1px solid #db7403; background: #f8efda; padding: 10px 15px;'>#}
    <div style='padding: 5px 0 10px 0;'>
        {% dictionary collection description as content %}
		{{ content|safe }}
    </div>
    <hr/>
    
    {#<div style='padding: 5px 16px; font-style: italic;'>#}
    <div style='font-style: italic;'>
        Last updated {% mktime collection.modified %}
        
        {% if can_edit %}
            <span style='padding: 0 5px;'>&raquo;</span>
            <a href="{% url library_collection_edit collection.id %}">edit now</a>
        {% endif %}
        
    </div>
    
    <br/><br/>
    
    {% for r in collection.get_ordered_resources %}
        <div class='minipost'>
        <div class='minipostcontents'>
        <div class='minipost-title'>
            <h3><a href="{% url library_resource r.id %}">{{ r.name }}</a></h3>
        </div>
        <div class='minipost-text'>
            {{ r.description|truncate_head:150 }}
        </div>
        </div>
        </div>
    {% endfor %}

{% endblock %}

{% block toolbar_right %}
    <div style='height: 45px;'>&nbsp;</div>
    
    {% if collection.has_children %}
        <div style='border: 1px solid #db7403; background: #f8efda; padding: 10px 15px;'>
            <strong>
                INSIDE<br/>
                <span style='font-size: 1.5em;'>{{ collection.name|upper }}</span>
            </strong>
            <br/><br/>
        </div>
        
        {% for child in collection.get_children %}
            <div style='border: 1px solid #db7403; border-top: 0; background: #f8efda; padding: 10px 15px;'>
                <a href="{% url library_collection child.id %}">{{ child.name }}</a>
                {% with child.get_total_resources as subresources %}
                    {% if subresources %}
                        &nbsp;
                        <span style='color: #808080;'>( {{ subresources }} )</span>
                    {% endif %}
                {% endwith %}
            </div>
        {% endfor %}
        
        </div>
    {% endif %}
{% endblock %}
